var CURRENT_ORIENTATION=Ti.Platform.displayCaps.platformHeight>Ti.Platform.displayCaps.platformWidth?Ti.UI.PORTRAIT:Ti.UI.LANDSCAPE_LEFT,Widget=function(e){function t(){CURRENT_ORIENTATION=Ti.Platform.displayCaps.platformHeight>Ti.Platform.displayCaps.platformWidth?Ti.UI.PORTRAIT:Ti.UI.LANDSCAPE_LEFT,CURRENT_ORIENTATION==Ti.UI.PORTRAIT?(a.slideIn(),a.rightContainer.setLeft(i.itemShortWidth)):(a.slideOut(),a.rightContainer.setLeft(i.itemLongWidth),a.darker.hide())}var i={activeMarkerWidth:e.navigation.activeMarkerWidth||10,activeMarkerColor:e.navigation.activeMarkerColor||"#ef90",activeBackgroundColor:e.navigation.activeBackgroundColor||"#ddd",itemLongWidth:e.navigation.itemLongWidth||200,itemShortWidth:e.navigation.itemShortWidth||90,backgroundColor:e.navigation.backgroundColor||"gray",darkerColor:e.navigation.darkerColor||"#8000",defaultIsout:e.defaultIsout||!0,defaultContent:e.defaultContent||0,navBarItemHeight:e.navBarItemHeight||90,iconItemHeight:e.iconItemHeight||80},a=Ti.UI.createView({isOut:i.defaultIsout,activeItem:i.defaultContent});return a.rightContainer=Ti.UI.createView({left:i.itemShortWidth,backgroundColor:"#f90",itemId:a.activeItem}),e.items[a.activeItem]&&e.items[a.activeItem].contentView&&a.rightContainer.add(e.items[a.activeItem].contentView),a.add(a.rightContainer),a.darker=Ti.UI.createView({backgroundColor:i.darkerColor,bubbleParent:!1,visible:!1,touchEnabled:!0}),a.add(a.darker),a.navBar=Ti.UI.createView({scrollType:"vertical",layout:"vertical",contentHeight:Ti.UI.SIZE,contentWidth:Ti.UI.FILL,left:i.defaultIsout?-i.itemLongWidth:0,backgroundColor:"#eee",width:i.itemLongWidth}),e.items.forEach(function(e,t){e.titleView.touchEnabled=!1;var o=Ti.UI.createView({top:0,itemId:t,backgroundColor:t==a.activeItem?i.activeBackgroundColor:void 0,height:i.navBarItemHeight});o.add(e.titleView),o.add(Ti.UI.createView({right:0,width:i.activeMarkerWidth,backgroundColor:i.activeMarkerColor,height:Ti.UI.FILL})),a.navBar.add(o)}),a.add(a.navBar),a.iconBar=Ti.UI.createScrollView({left:i.defaultIsout?0:-i.itemShortWidth,scrollType:"vertical",contentHeight:Ti.UI.SIZE,contentWidth:Ti.UI.FILL,backgroundColor:"silver",layout:"vertical",inputType:"toggle",width:i.itemShortWidth}),e.items.forEach(function(e,t){var o=Ti.UI.createView({top:0,itemId:t,height:i.iconItemHeight});e.iconView.touchEnabled=!1,o.add(e.iconView),o.add(Ti.UI.createView({right:0,width:i.activeMarkerWidth,backgroundColor:i.activeMarkerColor,height:Ti.UI.FILL})),a.iconBar.add(o)}),a.add(a.iconBar),a.emphaseItem=function(){a.navBar.children.forEach(function(e){e.backgroundColor=void 0,e.children[1].hide()}),a.iconBar.children.forEach(function(e){e.backgroundColor=void 0,e.children[1].hide()}),a.navBar.children[a.activeItem].backgroundColor=i.activeBackgroundColor,a.navBar.children[a.activeItem].children[1].show(),a.iconBar.children[a.activeItem].backgroundColor=i.activeBackgroundColor,a.iconBar.children[a.activeItem].children[1].show()},a.slideOut=function(){1==a.isOut&&(a.iconBar.animate({left:-i.itemShortWidth,duration:400}),a.navBar.animate({left:0},function(){a.isOut=!1}),CURRENT_ORIENTATION==Ti.UI.PORTRAIT&&a.darker.show())},a.slideIn=function(){0==a.isOut&&(a.navBar.animate({left:-i.itemLongWidth,duration:401}),a.iconBar.animate({left:0},function(){a.isOut=!0}),a.darker.hide())},a.toggleNavi=function(){CURRENT_ORIENTATION==Ti.UI.PORTRAIT&&(a.isOut?a.slideOut():a.slideIn())},a.onNaviClickhandler=function(t){if(void 0===t.source.itemId)a.toggleNavi();else if(a.isOut||a.toggleNavi(),a.rightContainer.itemId!=t.source.itemId){a.activeItem=t.source.itemId,a.emphaseItem(),a.rightContainer.removeAllChildren();var i=e.items[t.source.itemId];a.rightContainer.add(i.contentView),a.rightContainer.itemId=t.source.itemId}},a.darker.addEventListener("click",a.onNaviClickhandler),a.navBar.addEventListener("click",a.onNaviClickhandler),a.iconBar.addEventListener("click",a.onNaviClickhandler),Ti.Gesture.addEventListener("orientationchange",t),t(),a.emphaseItem(),a};module.exports=function(e){return new Widget(e)};